<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seat Busyness Chart</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fafafa;
      padding: 2rem;
    }

    h2 {
      text-align: center;
    }

    .chart-container {
      display: flex;
      flex-direction: column;
      gap: 30px;
      max-width: 1000px;
      margin: auto;
    }

    .chart {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .day-row {
      display: flex;
      align-items: flex-end;
      height: 100px;
    }

    .day-label {
      width: 80px;
      text-align: right;
      margin-right: 10px;
      font-weight: bold;
      align-self: center;
    }

    .bar-container {
      display: flex;
      flex-grow: 1;
      height: 100px;
      align-items: flex-end;
    }

    .bar {
      flex: 1;
      margin: 0 1px;
      background: #4a90e2;
      height: 0%;
      transition: height 0.3s;
    }

    .bar:hover {
      background: #357ABD;
    }

    .hour-labels {
      display: flex;
      margin-left: 90px;
      font-size: 12px;
    }

    .hour-labels div {
      flex: 1;
      text-align: center;
    }

    .location-title {
      text-align: center;
      font-size: 1.2rem;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <h2>Seat Busyness Chart</h2>
  <div class="chart-container" id="chartContainer"></div>

  <script>
    // Fetch the JSON data
    fetch('output/seat_busyness.json')
      .then(response => response.json())
      .then(busynessData => {
        const chartContainer = document.getElementById('chartContainer');

        // Process each location
        Object.entries(busynessData).forEach(([locationName, data]) => {
          const locationChart = document.createElement('div');
          locationChart.className = 'chart';

          // Title for the location
          const locationTitle = document.createElement('div');
          locationTitle.className = 'location-title';
          locationTitle.textContent = locationName;
          locationChart.appendChild(locationTitle);

          // Get max value to normalize busyness values (height of bars)
          const maxVal = Math.max(...Object.values(data).flat());

          // Generate day rows
          Object.entries(data).forEach(([day, values]) => {
            const row = document.createElement('div');
            row.className = 'day-row';

            // Day label
            const label = document.createElement('div');
            label.className = 'day-label';
            label.textContent = day;

            const bars = document.createElement('div');
            bars.className = 'bar-container';

            // Create the bars for each hour
            values.forEach(val => {
              const bar = document.createElement('div');
              bar.className = 'bar';
              bar.style.height = `${(val / maxVal) * 100}%`;
              bars.appendChild(bar);
            });

            row.appendChild(label);
            row.appendChild(bars);
            locationChart.appendChild(row);
          });

          // Add the location chart to the container
          chartContainer.appendChild(locationChart);

          // Add hour labels at the bottom
          const hourLabels = document.createElement('div');
          hourLabels.className = 'hour-labels';
          for (let h = 6; h <= 23; h++) {
            const lbl = document.createElement('div');
            lbl.textContent = `${h}:00`;
            hourLabels.appendChild(lbl);
          }
          locationChart.appendChild(hourLabels);
        });
      })
      .catch(err => {
        console.error('Error loading JSON data:', err);
        document.body.innerHTML = '<p>Error loading the busyness data. Please try again later.</p>';
      });
  </script>

</body>
</html>
