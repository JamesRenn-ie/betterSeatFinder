<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seat Busyness Chart</title>
  <link rel="stylesheet" href="Styles.css">
</head>
<body>

  <h2>Seat Busyness Chart</h2>
  <div class="chart-container" id="chartContainer"></div>

  <script>
    // Fetch the JSON data
    fetch('../output/seat_busyness.json')
      .then(response => response.json())
      .then(busynessData => {
        const chartContainer = document.getElementById('chartContainer');

        // Process each location
        Object.entries(busynessData).forEach(([locationName, data]) => {
          const locationChart = document.createElement('div');
          locationChart.className = 'chart';

          // Count non-null data points
          let nonNullCount = 0;
          let totalCount = 0;

          Object.values(data).forEach(values => {
            values.forEach(val => {
              totalCount++;
              if (val !== null && val !== undefined && val !== 0) {
                nonNullCount++;
              }
            });
          });

          // Check if data coverage is less than 50%
          if (nonNullCount / totalCount < 0.2) {
            const message = document.createElement('div');
            message.className = 'no-data-message';
            message.textContent = `${locationName} don't check this space frequently enough to make a graph`;
            chartContainer.appendChild(message);
            return;
          }

          // Title for the location
          const locationTitle = document.createElement('div');
          locationTitle.className = 'location-title';
          locationTitle.textContent = locationName;
          locationChart.appendChild(locationTitle);

          // Get max value to normalize busyness values (height of bars)
          const maxVal = Math.max(...Object.values(data).flat());

          // Generate day rows
          Object.entries(data).forEach(([day, values]) => {
            const row = document.createElement('div');
            row.className = 'day-row';

            // Day label
            const label = document.createElement('div');
            label.className = 'day-label';
            label.textContent = day;

            const bars = document.createElement('div');
            bars.className = 'bar-container';

            // Create the bars for each hour
            values.forEach(val => {
              const bar = document.createElement('div');
              bar.className = 'bar';
              
              // Inverse the height: More seats free -> smaller bar (less busy)
              // If there is no data, set the height to 0%
              if (val === null || val === undefined || val === 0) {
                bar.style.height = '0%';
              } else {
                bar.style.height = `${((maxVal - val) / maxVal) * 100}%`; // Invert the height
              }
              bars.appendChild(bar);
            });

            row.appendChild(label);
            row.appendChild(bars);
            locationChart.appendChild(row);
          });

          // Add the location chart to the container
          chartContainer.appendChild(locationChart);

          // Add hour labels at the bottom
          const hourLabels = document.createElement('div');
          hourLabels.className = 'hour-labels';
          for (let h = 6; h <= 23; h++) {
            const lbl = document.createElement('div');
            lbl.textContent = `${h}:00`;
            hourLabels.appendChild(lbl);
          }
          locationChart.appendChild(hourLabels);
        });
      })
      .catch(err => {
        console.error('Error loading JSON data:', err);
        document.body.innerHTML = '<p>Error loading the busyness data. Please try again later.</p>';
      });
  </script>

</body>
</html>